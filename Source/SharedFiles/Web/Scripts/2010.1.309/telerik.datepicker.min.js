(function(b){var a=b.telerik;var c=null;var d=/\d/;a.datepicker=function(f,g){this.element=f;this.isValueChanged=false;b.extend(this,g);b("> .t-icon",f).bind("click",a.delegate(this,this.togglePopup));var e=b(".t-input",f).keydown(a.delegate(this,this.keyDown)).focus(a.delegate(this,this.show)).attr("autocomplete","off");this.focusedDate=this.selectedDate||(a.calendar.isInRange(this.focusedDate,this.minDate,this.maxDate)?this.focusedDate:new a.datetime(this.minDate.value));a.bind(this,{open:this.onOpen,close:this.onClose,change:this.onChange,load:this.onLoad});a.trigger(f,"load")};b.extend(a.datepicker,{hideSharedCalendar:function(g){var f=c.data("associatedDatePicker");if(f){if(b.contains(f,g.target)){return}var h=b(f).data("tDatePicker");if(h){h.parseDate(b(".t-input",f).val());h.hide()}}},adjustDate:function(e,f,h,g){if(e==0){a.datetime.modify(f,a.datetime.msPerDay*h)}else{if(e==1){f.addMonth(g)}else{f.addYear((e==2?g:10*g))}}}});a.datepicker.prototype={$calendar:function(){if(!c){c=b(a.calendar.html(this.focusedDate,this.selectedDate,this.minDate,this.maxDate)).hide().addClass("t-datepicker-calendar").bind("click",function(h){h.stopPropagation()}).appendTo(document.body).tCalendar({selectedDate:this.selectedDate,minDate:this.minDate,maxDate:this.maxDate});b(document).click(a.datepicker.hideSharedCalendar)}if(c.data("associatedDatePicker")!=this.element){calendar=c.data("tCalendar");calendar.minDate=this.minDate;calendar.maxDate=this.maxDate;calendar.selectedDate=this.selectedDate;calendar.goToView(0,this.focusedDate);var g=b(this.element).offset();g.top+=b(this.element).height();var f=a.fx._wrap(c);f.css(b.extend({position:"absolute"},g));c.unbind("change").bind("change",b.proxy(this.calendarChange,this)).unbind("navigate").bind("navigate",b.proxy(this.viewedMonthChanged,this)).data("associatedDatePicker",this.element);if(this.selectedDate){this.value(this.focusedDate)}}var e=calendar.currentView.index;if(!c.is(":visible")&&calendar.viewedMonth.value-this.focusedDate.value!=0){calendar.goToView(e,this.focusedDate).value(this.selectedDate)}a.calendar.focusDate(this.focusedDate,e,c);return c},isOpened:function(){return c&&c.data("associatedDatePicker")==this.element&&c.is(":visible")},viewedMonthChanged:function(h){var i=c.data("tCalendar");var f=i.viewedMonth;var g=i.currentView.index;if(g==0){this.focusedDate=this.selectedDate||this.focusedDate}else{this.focusedDate.year(f.year(),f.month(),this.focusedDate.date())}a.calendar.focusDate(this.focusedDate,g,c,h.direction)},value:function(e){if(arguments.length==0){return this.selectedDate===null?null:this.selectedDate.toDate()}var g=e===null?null:e.getDate||e.value?e:this.parse(e);var f=g===null;this.selectedDate=f?null:g.value?g:new a.datetime(g);if(!f){this.focusedDate=this.selectedDate}b(".t-input",this.element).val(f?"":a.calendar.formatDate(this.selectedDate.toDate(),this.format));if(this.isOpened()){this.$calendar().data("tCalendar").value(this.selectedDate)}return this},calendarChange:function(g){var f=new a.datetime(g.date);if(this.checkSelectedDate(this.selectedDate,f)){return this}b(".t-input",this.element).removeClass("t-state-error");this.hide()},checkSelectedDate:function(f,e){if(!f||(f.value>e.value||e.value>f.value)){this.value(e);return a.trigger(this.element,"change",{previousDate:f===null?null:f.toDate(),date:e.toDate()})}},togglePopup:function(g){g.preventDefault();if(this.isOpened()){var f=b(".t-input",this.element);this.parseDate(f.val());f.blur();this.hide()}else{b(".t-input",this.element).focus()}},showPopup:function(){var e=this.parse(b(":input",this.element).val());this.selectedDate=e;if(e!==null){this.focusedDate=new a.datetime(e.value)}a.fx.play(this.effects,this.$calendar(),{direction:"bottom"})},hidePopup:function(){if(this.isOpened()){a.fx.rewind(this.effects,this.$calendar(),{direction:"bottom"})}},show:function(){a.trigger(this.element,"open");this.showPopup()},hide:function(){if(this.isOpened()){a.trigger(this.element,"close")}this.hidePopup()},keyDown:function(o){var h=b(o.target).val();if(o.keyCode==9){this.parseDate(h);this.hide()}if(o.keyCode==27){this.hide()}if(this.isOpened()&&b(".t-overlay",c).length>0){return}var p;var r=false;var m=this.$calendar();var i=m.data("tCalendar");var q=i.viewedMonth;var j=i.currentView;var f=i.currentView.index;var g=new a.datetime(this.focusedDate.value);var l=function(w,e,v){if(!b(w,m).hasClass("t-state-disabled")){if("navigateUp"==e){f+=1}p=v||false;i[e]();return true}else{return false}};var s=function(){var e=a.calendar.findTarget(g,f,m,false)[0];i.navigateDown(o,e,f);f=f==0?0:f-1;p=true};var k=function(w,e,v){var x=!v?-1:1;if(!l(w,e,v)){return false}if(f==0){g.addMonth(x)}else{g.addYear(x*(f==1?1:f==2?10:100))}return true};if(m.is(":visible")&&!o.shiftKey){switch(o.keyCode){case 37:r=true;if(o.ctrlKey){if(!k(".t-nav-prev","navigateToPast")){return}}else{a.datepicker.adjustDate(f,g,-1,-1);if(j.navCheck(g,q,false)){if(!l(".t-nav-prev","navigateToPast")){return}}}break;case 38:r=true;if(o.ctrlKey){l(".t-nav-fast","navigateUp")}else{a.datepicker.adjustDate(f,g,-7,-4);if(j.navCheck(g,q,false)){if(!l(".t-nav-prev","navigateToPast")){return}}}break;case 39:r=true;if(o.ctrlKey){if(!k(".t-nav-next","navigateToFuture",true)){return}}else{a.datepicker.adjustDate(f,g,1,1);if(j.navCheck(g,q,true)){if(!l(".t-nav-next","navigateToFuture",true)){return}}}break;case 40:r=true;if(o.ctrlKey){s()}else{a.datepicker.adjustDate(f,g,7,4);if(j.navCheck(g,q,true)){if(!l(".t-nav-next","navigateToFuture",true)){return}}}break;case 33:if(!k(".t-nav-prev","navigateToPast")){return}r=true;break;case 34:if(!k(".t-nav-next","navigateToFuture",true)){return}r=true;break;case 35:g=a.calendar.views[f].firstLastDay(g,false,i);r=true;break;case 36:g=a.calendar.views[f].firstLastDay(g,true,i);r=true;break;case 13:if(this.isValueChanged){this.parseDate(h);this.isValueChanged=false;break}r=true;if(f==0){b(o.target).removeClass("t-state-error");if(this.checkSelectedDate(this.selectedDate,this.focusedDate)){return}this.hide()}else{s()}break}}else{if(o.altKey&&o.keyCode==40){this.show();var t=this.parseDate(h);if(h!=""&&t===null){r=true}}else{if(o.keyCode==13){this.parseDate(h)}}}if(r){o.preventDefault();g=a.calendar.fitDateToRange(g,this.minDate,this.maxDate);a.calendar.focusDate(g,f,m,p);this.focusedDate=g}else{var u=o.keyCode;var n=function(v,e,w){return v>e&&v<w};if(n(u,47,57)||n(u,65,90)||n(u,95,105)||u==8||u==32||u==47){this.isValueChanged=true}}},parseDate:function(f){var g=null;var h=function(){this.selectedDate=null;if(this.isOpened()){this.$calendar().data("tCalendar").selectedDate=null;b(".t-state-selected",this.$calendar()).removeClass("t-state-selected")}};if(f!=""){g=this.parse(f,this.format);var e=g===null;if(!e){this.focusedDate=g;if(this.checkSelectedDate(this.selectedDate,g)){return}}else{b.proxy(h,this)()}b(".t-input",this.element).toggleClass("t-state-error",e).val(e?f:a.calendar.formatDate(g.toDate(),this.format))}else{b(".t-input",this.element).removeClass("t-state-error");b.proxy(h,this)()}return g},parse:function(e,f,g){return d.test(e)?this.parseMachineDate(e,f):this.parseByToken(e,g)},parseMachineDate:function(e,p){p=p||this.format;var i=-1;var s=-1;var v=-1;var m="+10";var r=false;var h=function(x){var y=0;while(f(x)){y++;n++}return y};var j=function(){var x=f("'");if(x){n++}return x};var f=function(x){return(n+1<p.length&&p.charAt(n+1)==x)};var l=function(z){var x=z=="y"?4:2;var y=new RegExp("^\\d{1,"+x+"}");var A=e.substring(g).match(y);if(A){g+=A[0].length;return parseInt(A[0],10)}else{return -1}};var t=function(y){for(var x=0;x<y.length;x++){if(e.substr(g,y[x].length)==y[x]){g+=y[x].length;return x+1}}return -1};var o=function(){if(e.charAt(g)==p.charAt(n)){g++}};var g=0;for(var n=0,k=p.length;n<k;n++){if(r){o();if(p.charAt(n)=="'"){r=false}}else{switch(p.charAt(n)){case"d":var u=h("d");v=u<=1?l("d"):t(a.cultureInfo[u==3?"days":"abbrDays"]);break;case"M":var u=h("M");s=u<=1?l("M"):t(a.cultureInfo[u==3?"months":"abbrMonths"]);break;case"y":h("y");i=l("y");break;case"'":o();r=true;break;default:o()}}}if(g<e.length-1){return null}var q=new a.datetime();if(i==-1){i=q.year()}else{if(i<100){i+=q.year()-q.year()%100+(i<=m?0:-100)}}var w=new a.datetime(i,s-1,v);w.hours(w.hours()>12?w.hours()+2:0);if(w.year()!=i&&w.month()+1!=s&&w.date()!=v){return null}w=a.calendar.isInRange(w,this.minDate,this.maxDate)?w:null;return w},parseByToken:function(h,m){m=m||new a.datetime();var n=null;var f=null;var i=null;var e=0;var l=function(o){var p=null;if(o&&h.substring(e,e+o.length).toLowerCase()==o.toLowerCase()){p=o}return p};var g=function(){var o=null;b.each(["days","abbrDays","months","abbrMonths"],function(q,p){if(o!==null){return}b.each(a.cultureInfo[p],function(s,r){if(o!==null){return}o=l(r)});i=p});return o};var k=function(){var p;var q=function(s,r){m[r?"date":"month"](m[r?"date":"month"]()+(p!=0?((p+((p>0?1:-1)*s))%s):0)+(f?(n==a.cultureInfo.next?1:-1)*s:0))};var o=b.inArray(f||n,a.cultureInfo[i]);if(i.toLowerCase().indexOf("day")>-1){p=(o==0?7:o)-m.day();q(7,true)}else{p=o-m.month();q(12,false)}};var j=function(){var o=function(r){var q;switch(f){case"year":q=r==1?1:0;break;case"month":q=r==2?1:0;break;case"week":q=r==3?7:0;break;case"day":q=r==3?1:0;break}return q};var p=(n==a.cultureInfo.next?1:-1);m.year(m.year()+o(1)*p,m.month()+o(2)*p,m.date()+o(3)*p)};b.each(["today","tomorrow","yesterday","next","last"],function(p,o){if(n!==null){return}n=l(a.cultureInfo[o])});if(n!==null){e+=n.length;if(/[^\s\d]\s+[^\s\d]/i.test(h)){e++;b.each(["year","month","week","day"],function(p,o){if(f!==null){return}f=l(a.cultureInfo[o])});i=null;if(f===null){f=g()}if(f===null){return null}}else{switch(n){case a.cultureInfo.today:break;case a.cultureInfo.tomorrow:m.date(m.date()+1);break;case a.cultureInfo.yesterday:m.date(m.date()-1);break;default:m=null;break}m=a.calendar.isInRange(m,this.minDate,this.maxDate)?m:null;return m}}else{n=g();if(n!=null){k();m=a.calendar.isInRange(m,this.minDate,this.maxDate)?m:null;return m}else{return null}}if(i!==null){k()}else{j()}m=a.calendar.isInRange(m,this.minDate,this.maxDate)?m:null;return m}};b.fn.tDatePicker=function(e){e=b.extend({},b.fn.tDatePicker.defaults,e);return this.each(function(){e=b.meta?b.extend({},e,b(this).data()):e;if(!b(this).data("tDatePicker")){b(this).data("tDatePicker",new a.datepicker(this,e))}})};b.fn.tDatePicker.defaults={effects:a.fx.slide.defaults(),selectedDate:null,format:a.cultureInfo.shortDate,focusedDate:new a.datetime(),minDate:new a.datetime(1899,11,31),maxDate:new a.datetime(2100,0,1)}})(jQuery);