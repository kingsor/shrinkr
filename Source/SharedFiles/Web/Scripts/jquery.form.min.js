/*
 * jQuery Form Plugin
 * version: 2.43 (12-MAR-2010)
 * @requires jQuery v1.3.2 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(B){B.fn.ajaxSubmit=function(O){if(!this.length){A("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof O=="function"){O={success:O}}var E=B.trim(this.attr("action"));if(E){E=(E.match(/^([^#]+)/)||[])[1]}E=E||window.location.href||"";O=B.extend({url:E,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},O||{});var Q={};this.trigger("form-pre-serialize",[this,O,Q]);if(Q.veto){A("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(O.beforeSerialize&&O.beforeSerialize(this,O)===false){A("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var K=this.formToArray(O.semantic);if(O.data){O.extraData=O.data;for(var F in O.data){if(O.data[F] instanceof Array){for(var G in O.data[F]){K.push({name:F,value:O.data[F][G]})}}else{K.push({name:F,value:O.data[F]})}}}if(O.beforeSubmit&&O.beforeSubmit(K,this,O)===false){A("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[K,this,O,Q]);if(Q.veto){A("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var D=B.param(K);if(O.type.toUpperCase()=="GET"){O.url+=(O.url.indexOf("?")>=0?"&":"?")+D;O.data=null}else{O.data=D}var P=this,J=[];if(O.resetForm){J.push(function(){P.resetForm()})}if(O.clearForm){J.push(function(){P.clearForm()})}if(!O.dataType&&O.target){var M=O.success||function(){};J.push(function(S){var R=O.replaceTarget?"replaceWith":"html";B(O.target)[R](S).each(M,arguments)})}else{if(O.success){J.push(O.success)}}O.success=function(U,S,V){for(var T=0,R=J.length;T<R;T++){J[T].apply(O,[U,S,V||P,P])}};var C=B("input:file",this).fieldValue();var N=false;for(var I=0;I<C.length;I++){if(C[I]){N=true}}var H=false;if((C.length&&O.iframe!==false)||O.iframe||N||H){if(O.closeKeepAlive){B.get(O.closeKeepAlive,L)}else{L()}}else{B.ajax(O)}this.trigger("form-submit-notify",[this,O]);return this;function L(){var V=P[0];if(B(":input[name=submit]",V).length){alert('Error: Form elements must not be named "submit".');return }var T=B.extend({},B.ajaxSettings,O);var h=B.extend(true,{},B.extend(true,{},B.ajaxSettings),T);var U="jqFormIO"+(new Date().getTime());var c=B('<iframe id="'+U+'" name="'+U+'" src="'+T.iframeSrc+'" onload="(jQuery(this).data(\'form-plugin-onload\'))()" />');var e=c[0];c.css({position:"absolute",top:"-1000px",left:"-1000px"});var f={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;c.attr("src",T.iframeSrc)}};var d=T.global;if(d&&!B.active++){B.event.trigger("ajaxStart")}if(d){B.event.trigger("ajaxSend",[f,T])}if(h.beforeSend&&h.beforeSend(f,h)===false){h.global&&B.active--;return }if(f.aborted){return }var S=false;var Z=0;var R=V.clk;if(R){var X=R.name;if(X&&!R.disabled){T.extraData=T.extraData||{};T.extraData[X]=R.value;if(R.type=="image"){T.extraData[X+".x"]=V.clk_x;T.extraData[X+".y"]=V.clk_y}}}function W(){var j=P.attr("target"),g=P.attr("action");V.setAttribute("target",U);if(V.getAttribute("method")!="POST"){V.setAttribute("method","POST")}if(V.getAttribute("action")!=T.url){V.setAttribute("action",T.url)}if(!T.skipEncodingOverride){P.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(T.timeout){setTimeout(function(){Z=true;a()},T.timeout)}var i=[];try{if(T.extraData){for(var k in T.extraData){i.push(B('<input type="hidden" name="'+k+'" value="'+T.extraData[k]+'" />').appendTo(V)[0])}}c.appendTo("body");c.data("form-plugin-onload",a);V.submit()}finally{V.setAttribute("action",g);j?V.setAttribute("target",j):P.removeAttr("target");B(i).remove()}}if(T.forceSync){W()}else{setTimeout(W,10)}var Y=100;function a(){if(S){return }var i=true;try{if(Z){throw"timeout"}var j,m;m=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;var n=T.dataType=="xml"||m.XMLDocument||B.isXMLDoc(m);A("isXml="+n);if(!n&&(m.body==null||m.body.innerHTML=="")){if(--Y){A("requeing onLoad callback, DOM not available");setTimeout(a,250);return }A("Could not access iframe DOM after 100 tries.");return }A("response detected");S=true;f.responseText=m.body?m.body.innerHTML:null;f.responseXML=m.XMLDocument?m.XMLDocument:m;f.getResponseHeader=function(p){var o={"content-type":T.dataType};return o[p]};if(T.dataType=="json"||T.dataType=="script"){var g=m.getElementsByTagName("textarea")[0];if(g){f.responseText=g.value}else{var l=m.getElementsByTagName("pre")[0];if(l){f.responseText=l.innerHTML}}}else{if(T.dataType=="xml"&&!f.responseXML&&f.responseText!=null){f.responseXML=b(f.responseText)}}j=B.httpData(f,T.dataType)}catch(k){A("error caught:",k);i=false;f.error=k;B.handleError(T,f,"error",k)}if(i){T.success(j,"success");if(d){B.event.trigger("ajaxSuccess",[f,T])}}if(d){B.event.trigger("ajaxComplete",[f,T])}if(d&&!--B.active){B.event.trigger("ajaxStop")}if(T.complete){T.complete(f,i?"success":"error")}setTimeout(function(){c.removeData("form-plugin-onload");c.remove();f.responseXML=null},100)}function b(g,i){if(window.ActiveXObject){i=new ActiveXObject("Microsoft.XMLDOM");i.async="false";i.loadXML(g)}else{i=(new DOMParser()).parseFromString(g,"text/xml")}return(i&&i.documentElement&&i.documentElement.tagName!="parsererror")?i:null}}};B.fn.ajaxForm=function(C){return this.ajaxFormUnbind().bind("submit.form-plugin",function(D){D.preventDefault();B(this).ajaxSubmit(C)}).bind("click.form-plugin",function(H){var G=H.target;var E=B(G);if(!(E.is(":submit,input:image"))){var D=E.closest(":submit");if(D.length==0){return }G=D[0]}var F=this;F.clk=G;if(G.type=="image"){if(H.offsetX!=undefined){F.clk_x=H.offsetX;F.clk_y=H.offsetY}else{if(typeof B.fn.offset=="function"){var I=E.offset();F.clk_x=H.pageX-I.left;F.clk_y=H.pageY-I.top}else{F.clk_x=H.pageX-G.offsetLeft;F.clk_y=H.pageY-G.offsetTop}}}setTimeout(function(){F.clk=F.clk_x=F.clk_y=null},100)})};B.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};B.fn.formToArray=function(N){var M=[];if(this.length==0){return M}var D=this[0];var H=N?D.getElementsByTagName("*"):D.elements;if(!H){return M}for(var I=0,K=H.length;I<K;I++){var E=H[I];var F=E.name;if(!F){continue}if(N&&D.clk&&E.type=="image"){if(!E.disabled&&D.clk==E){M.push({name:F,value:B(E).val()});M.push({name:F+".x",value:D.clk_x},{name:F+".y",value:D.clk_y})}continue}var O=B.fieldValue(E,true);if(O&&O.constructor==Array){for(var G=0,C=O.length;G<C;G++){M.push({name:F,value:O[G]})}}else{if(O!==null&&typeof O!="undefined"){M.push({name:F,value:O})}}}if(!N&&D.clk){var J=B(D.clk),L=J[0],F=L.name;if(F&&!L.disabled&&L.type=="image"){M.push({name:F,value:J.val()});M.push({name:F+".x",value:D.clk_x},{name:F+".y",value:D.clk_y})}}return M};B.fn.formSerialize=function(C){return B.param(this.formToArray(C))};B.fn.fieldSerialize=function(D){var C=[];this.each(function(){var H=this.name;if(!H){return }var F=B.fieldValue(this,D);if(F&&F.constructor==Array){for(var G=0,E=F.length;G<E;G++){C.push({name:H,value:F[G]})}}else{if(F!==null&&typeof F!="undefined"){C.push({name:this.name,value:F})}}});return B.param(C)};B.fn.fieldValue=function(H){for(var G=[],E=0,C=this.length;E<C;E++){var F=this[E];var D=B.fieldValue(F,H);if(D===null||typeof D=="undefined"||(D.constructor==Array&&!D.length)){continue}D.constructor==Array?B.merge(G,D):G.push(D)}return G};B.fieldValue=function(C,I){var E=C.name,N=C.type,O=C.tagName.toLowerCase();if(typeof I=="undefined"){I=true}if(I&&(!E||C.disabled||N=="reset"||N=="button"||(N=="checkbox"||N=="radio")&&!C.checked||(N=="submit"||N=="image")&&C.form&&C.form.clk!=C||O=="select"&&C.selectedIndex==-1)){return null}if(O=="select"){var J=C.selectedIndex;if(J<0){return null}var L=[],D=C.options;var G=(N=="select-one");var K=(G?J+1:D.length);for(var F=(G?J:0);F<K;F++){var H=D[F];if(H.selected){var M=H.value;if(!M){M=(H.attributes&&H.attributes.value&&!(H.attributes.value.specified))?H.text:H.value}if(G){return M}L.push(M)}}return L}return C.value};B.fn.clearForm=function(){return this.each(function(){B("input,select,textarea",this).clearFields()})};B.fn.clearFields=B.fn.clearInputs=function(){return this.each(function(){var D=this.type,C=this.tagName.toLowerCase();if(D=="text"||D=="password"||C=="textarea"){this.value=""}else{if(D=="checkbox"||D=="radio"){this.checked=false}else{if(C=="select"){this.selectedIndex=-1}}}})};B.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};B.fn.enable=function(C){if(C==undefined){C=true}return this.each(function(){this.disabled=!C})};B.fn.selected=function(C){if(C==undefined){C=true}return this.each(function(){var D=this.type;if(D=="checkbox"||D=="radio"){this.checked=C}else{if(this.tagName.toLowerCase()=="option"){var E=B(this).parent("select");if(C&&E[0]&&E[0].type=="select-one"){E.find("option").selected(false)}this.selected=C}}})};function A(){if(B.fn.ajaxSubmit.debug){var C="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(C)}else{if(window.opera&&window.opera.postError){window.opera.postError(C)}}}}})(jQuery);