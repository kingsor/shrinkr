(function(b){var a=b.telerik;a.treeview=function(d,e){this.element=d;var c=b(d);b.extend(this,e);b("div:not(.t-state-disabled) > .t-in:not(.t-state-selected)",d).live("mouseenter",a.hover).live("mouseleave",a.leave).live("click",a.delegate(this,this.nodeSelect));b(".t-in.t-state-selected",d).live("mouseenter",a.preventDefault);b("div:not(.t-state-disabled) .t-in",d).live("dblclick",a.delegate(this,this.nodeClick));if(this.dragAndDrop){a.bind(this,{nodeDragStart:this.onNodeDragStart,nodeDragging:this.onNodeDragging,nodeDragCancelled:this.onNodeDragCancelled,nodeDrop:this.onNodeDrop,nodeDropped:this.onNodeDropped});a.draganddrop(this.element.id,b.extend({draggables:b("div:not(.t-state-disabled) .t-in",d)},a.draganddrop.applyContext(a.draganddrop.treeview,this)))}b(".t-plus, .t-minus",d).live("click",a.delegate(this,this.nodeClick));b(":checkbox",d).live("click",a.delegate(this,this.updateCheckState));var f=c.find(".t-item > .t-content");if(f.length>0&&b(f[0]).children().length==0){c.find(".t-icon").hide()}a.bind(this,{expand:this.onExpand,collapse:this.onCollapse,select:this.onSelect,error:this.onError,load:this.onLoad,dataBinding:this.onDataBinding,dataBound:this.onDataBound});a.trigger(c,"load")};a.treeview.prototype={expand:function(c){b(c).each(b.proxy(function(g,f){var e=b(f);var d=e.find("> .t-group, > .t-content");if((d.length>0&&!d.is(":visible"))||this.isAjax()){this.nodeToggle(null,e)}},this))},collapse:function(c){b(c).each(b.proxy(function(g,f){var e=b(f);var d=e.find("> .t-group, > .t-content");if(d.length>0&&d.is(":visible")){this.nodeToggle(null,e)}},this))},enable:function(c){this.toggle(c,true)},disable:function(c){this.toggle(c,false)},toggle:function(c,d){b(c).each(b.proxy(function(g,f){var e=b(f);this.collapse(e);e.find("> div > .t-icon").toggleClass("t-state-default",d).toggleClass("t-state-disabled",!d);e.find("> div > .t-in").toggleClass("t-state-default",d).toggleClass("t-state-disabled",!d)},this))},shouldNavigate:function(c){var e=b(c).closest(".t-item").find("> .t-content, > .t-group");var d=b(c).attr("href");return !((d&&(d.charAt(d.length-1)=="#"||d.indexOf("#"+this.element.id+"-")!=-1))||(e.length>0&&e.children().length==0))},nodeSelect:function(d,c){if(!this.shouldNavigate(c)){d.preventDefault()}if(!b(c).hasClass(".t-state-selected")&&!a.trigger(this.element,"select",{item:c.parentNode})){b(".t-in",this.element).removeClass("t-state-hover t-state-selected");b(c).addClass("t-state-selected")}},nodeToggle:function(g,f,c){if(g!=null){g.preventDefault()}if(f.data("animating")||!f.find("> div > .t-icon").is(":visible")||f.find("> div > .t-in").hasClass("t-state-disabled")){return}f.data("animating",!c);var h=f.find("> .t-group, > .t-content");var d=!h.is(":visible");if(h.children().length>0&&!a.trigger(this.element,d?"expand":"collapse",{item:f.find("> div")[0]})){f.find("> div > .t-icon").toggleClass("t-minus",d).toggleClass("t-plus",!d);if(!c){a.fx[d?"play":"rewind"](this.effects,h,{direction:"bottom"},function(){f.data("animating",false)})}else{h[d?"show":"hide"]()}}else{if(d&&this.isAjax()&&h.length==0){this.ajaxRequest(f)}}},nodeClick:function(g,f){var c=b(f);var d=c.closest(".t-item");if(c.hasClass("t-plus-disabled")||c.hasClass("t-minus-disabled")){return}this.nodeToggle(g,d)},isAjax:function(){return this.ajax||this.ws||this.onDataBinding},url:function(c){return(this.ajax||this.ws)[c]},ajaxOptions:function(d,e){var c={type:"POST",dataType:"text",error:b.proxy(function(h,g){if(a.ajaxError(this.element,"error",h,g)){return}if(g=="parsererror"){alert("Error! The requested URL did not return JSON.")}},this),success:b.proxy(function(g){g=eval("("+g+")");g=g.d||g;this.dataBind(d,g)},this)};c=b.extend(c,e);var f=this.ws?c.data.node={}:c.data;if(d.hasClass("t-item")){f[this.queryString.value]=this.getItemValue(d);f[this.queryString.text]=this.getItemText(d)}if(this.ws){c.data=a.toJson(c.data);c.contentType="application/json; charset=utf-8"}return c},ajaxRequest:function(c){if(a.trigger(this.element,"dataBinding")||(!this.ajax&&!this.ws)){return}c=c||b(this.element);if(!c.hasClass("t-item")){b('<div><span class="t-icon"/><div>').appendTo(c)}c.data("loadingIconTimeout",setTimeout(function(){c.find("> div > .t-icon").addClass("t-loading")},100));b.ajax(this.ajaxOptions(c,{data:{},url:this.url("selectUrl")}))},isValidModel:function(d){var c=false;b.each(["Text","Value"],function(g,f){c=false;for(var e in d[0]){if(e==f){c=true;break}}return c});return c},bindTo:function(d){var c=b(this.element);this.dataBind(c,d);a.trigger(c,"dataBound")},dataBind:function(d,e){if(e.length==0){b(".t-icon",d).hide();return}if(!this.isValidModel(e)){alert("Server returned invalid data!");return}var c=new a.stringBuilder();a.treeview.getGroupHtml(e,c,this.isAjax(),d.hasClass("t-treeview"));d.data("animating",true);if(!d.hasClass("t-item")){d.children().remove()}a.fx.play(this.effects,b(c.string()).appendTo(d),{direction:"bottom"},function(){d.data("animating",false)});clearTimeout(d.data("loadingIconTimeout"));if(d.hasClass("t-item")){b(".t-icon:first",d).removeClass("t-loading").removeClass("t-plus").addClass("t-minus")}},updateCheckState:function(i,c){var j=b(c);var f=j.closest(".t-item");var g=b(".t-checkbox",f);var k=g.find(':input[name="checkedNodes.Index"]');var h=j.is(":checked");if(!h){g.find(':input[name="checkedNodes['+k.val()+'].Text"]').remove();g.find(':input[name="checkedNodes['+k.val()+'].Value"]').remove()}else{var d=new a.stringBuilder();d.cat('<input type="hidden" value="').cat(this.getItemValue(f)).cat('" name="checkedNodes[').cat(k.val()).cat('].Value" class="t-input">').cat('<input type="hidden" value="').cat(this.getItemText(f)).cat('" name="checkedNodes[').cat(k.val()).cat('].Text" class="t-input">');b(d.string()).appendTo(g)}},getItemText:function(c){return b(".t-in:first",c).text()},getItemValue:function(c){return c.find(':input[name="itemValue"]').eq(0).val()||this.getItemText()}};b.extend(a.draganddrop,{treeview:{shouldDrag:function(c){return true},createDragClue:function(c){return c.closest(".t-top,.t-mid,.t-bot").text()},onDragStart:function(c){var d=a.trigger(this.element,"nodeDragStart",{item:c[0]});if(!d){this.$dropClue=b('<div class="t-drop-clue" />').appendTo(this.element)}return d},onDragMove:function(k,m){var g;a.trigger(this.element,"nodeDragging",{dropTarget:k.target,setStatusClass:function(e){g=e},item:m[0]});if(g){return g}if(this.dragAndDrop.dropTargets&&b(k.target).closest(this.dragAndDrop.dropTargets).length>0){return"t-add"}if(!b.contains(this.element,k.target)){this.$dropClue.css("visibility","hidden");return}else{if(b.contains(m.closest(".t-item")[0],k.target)){this.$dropClue.css("visibility","hidden");return"t-denied"}}this.$dropClue.css("visibility","visible");var n="t-insert-middle";var j=b(k.target);var o=j.closest(".t-top,.t-mid,.t-bot");if(o.length>0){var h=o.outerHeight();var c=o.offset().top;var f=j.closest(".t-in");var d=h/(f.length>0?4:2);var q=k.pageY<(c+d);var i=(c+h-d)<k.pageY;var l=f.length>0&&!q&&!i;f.toggleClass("t-state-hover",l);this.$dropClue.css("visibility",l?"hidden":"visible");if(l){n="t-add";this.$dropTarget=j}else{var p=o.position();p.top+=q?0:h;this.$dropClue.css(p)[q?"prependTo":"appendTo"](j.closest(".t-item").find("> div:first"));n="t-insert-middle";if(q&&o.hasClass("t-top")){n="t-insert-top"}if(i&&o.hasClass("t-bot")){n="t-insert-bottom"}}}return n},onDragCancelled:function(c){a.trigger(this.element,"nodeDragCancelled",{item:c[0]});this.$dropClue.remove()},onDrop:function(g,c,f){var d=a.trigger(this.element,"nodeDrop",{dropTarget:g.target,item:c[0]});if(d||!b.contains(this.element,g.target)){this.$dropClue.remove();return d}return d?true:b.proxy(function(e){var h=c.closest(".t-top,.t-mid,.t-bot");var m=h.parent();var p=h.closest(".t-group");if(b.contains(m[0],g.target)){e();this.$dropClue.remove();return}if(m.hasClass("t-last")){m.removeClass("t-last").prev().addClass("t-last").find("> div").removeClass("t-top t-mid").addClass("t-bot")}var o="over";var i;if(this.$dropClue.css("visibility")=="visible"){var j=this.$dropClue.closest(".t-item");o=this.$dropClue.prev(".t-in").length>0?"after":"before";i=j.find("> div");j[o](m)}else{i=this.$dropTarget.closest(".t-top,.t-mid,.t-bot");var k=i.next(".t-group");if(k.length===0){k=b('<ul class="t-group" />').appendTo(i.parent());i.prepend('<span class="t-icon t-minus" />')}k.append(m);if(i.find("> .t-icon").hasClass("t-plus")){this.nodeToggle(null,i.parent(),true)}}a.trigger(this.element,"nodeDropped",{destinationItem:i[0],dropPosition:o,item:h[0]});var n=m.parents(".t-group").length;var l=function(r){var s=r.prev().length===0;var q=r.next().length===0;r.toggleClass("t-first",s&&n===1).toggleClass("t-last",q).find("> div").toggleClass("t-top",s&&!q).toggleClass("t-mid",!s&&!q).toggleClass("t-bot",q)};l(m);l(m.prev());l(m.next());if(p.children().length===0){p.prev("div").find(".t-plus,.t-minus").remove();p.remove()}e();this.$dropClue.remove()},this)}}});b.extend(a.treeview,{getGroupHtml:function(j,e,f,h){e.cat('<ul class="t-group').catIf(" t-treeview-lines",h).cat('">');if(j&&j.length>0){for(var g=0,c=j.length;g<c;g++){var d=j[g];e.cat('<li class="t-item').catIf(" t-first",h&&g==0).catIf(" t-last",g==c-1).cat('">').cat('<div class="').catIf("t-top ",h&&g==0).catIf("t-top",g!=c-1&&g==0).catIf("t-mid",g!=c-1&&g!=0).catIf("t-bot",g==c-1).catIf(" t-state-disabled",d.Enabled===false).cat('">');if((f&&d.LoadOnDemand)||(d.Items&&d.Items.length>0)){e.cat('<span class="t-icon').catIf(" t-plus",!d.Expanded).catIf(" t-minus",d.Expanded).catIf("-disabled",d.Enabled===false).cat('"').cat("></span>")}if(this.ShowCheckBox){e.cat('<input type="checkbox" value="').cat(d.Value).cat('" class="t-input').catIf(" t-state-disabled",d.Enabled===false).cat('"').catIf(' checked="checked"',d.Checked).cat("/>")}e.cat(d.NavigateUrl?'<a class="t-link t-in">':'<span class="t-in">');if(d.ImageUrl!=null){e.cat('<img class="t-image" alt="" src="').cat(d.ImageUrl).cat('" />')}e.cat(d.Text).cat(d.NavigateUrl?"</a>":"</span>").cat("</div>");if(d.Items&&d.Items.length>0){this.getGroupHtml(d.Items,e,f,false)}else{if(d.LoadOnDemand){e.cat('<input type="hidden" class="t-input" name="itemValue" value="').cat(d.Value).cat('" />')}}e.cat("</li>")}}e.cat("</ul>")}});b.fn.tTreeView=function(c){c=b.extend({},b.fn.tTreeView.defaults,c);return this.each(function(){c=b.meta?b.extend({},c,b(this).data()):c;if(!b(this).data("tTreeView")){var d=new a.treeview(this,c);b(this).data("tTreeView",d);if(d.isAjax()&&b(this).find(".t-item").length==0){d.ajaxRequest()}}})};b.fn.tTreeView.defaults={effects:a.fx.property.defaults("height"),queryString:{text:"Text",value:"Value"}}})(jQuery);